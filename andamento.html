// ===================================
//   FUNZIONI COLORI
// ===================================
export function getColor(val, type = "percent", darkMode = true) {
  let color = "transparent";

  if(type === "percent") {
    if (val > 20) color = darkMode ? "rgba(0,200,0,0.3)" : "rgba(0,128,0,0.3)";
    else if (val > 10) color = darkMode ? "rgba(0,180,0,0.25)" : "rgba(0,200,0,0.25)";
    else if (val > 0) color = darkMode ? "rgba(154,205,50,0.2)" : "rgba(154,205,50,0.2)";
    else if (val === 0) color = darkMode ? "rgba(255,200,0,0.2)" : "rgba(255,165,0,0.2)";
    else if (val > -10) color = darkMode ? "rgba(255,100,50,0.25)" : "rgba(255,69,0,0.25)";
    else color = darkMode ? "rgba(200,0,0,0.3)" : "rgba(139,0,0,0.3)";
  } else {
    if (val >= 10000) color = darkMode ? "rgba(0,200,0,0.3)" : "rgba(0,128,0,0.3)";
    else if (val >= 5000) color = darkMode ? "rgba(0,180,0,0.25)" : "rgba(0,200,0,0.25)";
    else if (val >= 1000) color = darkMode ? "rgba(154,205,50,0.2)" : "rgba(154,205,50,0.2)";
    else if (val >= 0) color = darkMode ? "rgba(255,200,0,0.2)" : "rgba(255,165,0,0.2)";
    else color = darkMode ? "rgba(255,100,50,0.25)" : "rgba(255,69,0,0.25)";
  }

  return color;
}

export function getTextColor(bg) {
  return "#fff"; // testo bianco in dark mode
}

// ===================================
//   RENDER TABELLARE
// ===================================
export function renderRiepilogoInTabella(dati) {
  const tbody = document.querySelector("#tabellaRiepilogo tbody");
  tbody.innerHTML = "";
  const darkMode = document.body.classList.contains("dark");

  dati.forEach(r => {
    const tr = document.createElement("tr");

    // Data
    let td = document.createElement("td");
    td.textContent = r.data;
    tr.appendChild(td);

    // Investito
    td = document.createElement("td");
    td.textContent = r.investito.toLocaleString("it-IT", {style:"currency", currency:"EUR"});
    td.style.backgroundColor = getColor(r.investito, "value", darkMode);
    td.style.color = getTextColor(td.style.backgroundColor);
    tr.appendChild(td);

    // Valore
    td = document.createElement("td");
    td.textContent = r.valore.toLocaleString("it-IT", {style:"currency", currency:"EUR"});
    td.style.backgroundColor = getColor(r.valore, "value", darkMode);
    td.style.color = getTextColor(td.style.backgroundColor);
    tr.appendChild(td);

    // Incremento
    td = document.createElement("td");
    td.textContent = r.incremento.toLocaleString("it-IT", {style:"currency", currency:"EUR"});
    td.style.backgroundColor = getColor(r.incremento, "value", darkMode);
    td.style.color = getTextColor(td.style.backgroundColor);
    tr.appendChild(td);

    // Profitto
    td = document.createElement("td");
    td.textContent = r.profitto.toLocaleString("it-IT", {style:"currency", currency:"EUR"});
    td.style.backgroundColor = getColor(r.profitto, "value", darkMode);
    td.style.color = getTextColor(td.style.backgroundColor);
    tr.appendChild(td);

    // % Profitto
    td = document.createElement("td");
    td.textContent = r.percentuale.toFixed(2) + "%";
    td.style.backgroundColor = getColor(r.percentuale, "percent", darkMode);
    td.style.color = getTextColor(td.style.backgroundColor);
    tr.appendChild(td);

    // Azioni
    td = document.createElement("td");
    td.textContent = r.azioni;
    tr.appendChild(td);

    tbody.appendChild(tr);
  });
}

// === ESEMPIO DATI ===
const datiRiepilogo = [
  {data: "2025-01", investito: 1000, valore: 1100, incremento: 100, profitto: 100, percentuale: 10, azioni: 5},
  {data: "2025-02", investito: 1200, valore: 1250, incremento: 50, profitto: 50, percentuale: 4.16, azioni: 4},
  {data: "2025-03", investito: 1500, valore: 1600, incremento: 100, profitto: 100, percentuale: 6.66, azioni: 6},
];

// === INIT RENDER ===
document.addEventListener("DOMContentLoaded", () => {
  renderRiepilogoInTabella(datiRiepilogo);
});
